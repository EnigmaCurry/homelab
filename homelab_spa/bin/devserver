#!/bin/bash

# Source this file, then run 'devserver'

if [[ $0 == "$BASH_SOURCE" ]]; then
    echo "Source this file, don't run it."
    exit 1
fi

if [[ ! -v DEVHOST ]]; then
    echo "DEVHOST is not set. Set a DEVHOST like: DEVHOST=homelab-dev.app.example.com"
else
    DEVUSER=admin
    DEVPASS=`sudo docker run --rm homelab/jupyter_ansible pwgen 10 1`
    TRAEFIK_AUTH="'"`sudo docker run --rm httpd htpasswd -nb admin $DEVPASS | head -n 1`"'"

    alias devinstall="sudo docker run --rm -it -v /var/lib/homelab/homelab_spa:/app homelab/homelab_spa npm install"
    alias devserver="sudo docker run --rm -it -v /var/lib/homelab/homelab_spa:/app -l traefik.frontend.rule=Host:$DEVHOST -l traefik.port=3000 -l traefik.frontend.auth.basic=$TRAEFIK_AUTH homelab/homelab_spa npm run dev -- --hostname=0.0.0.0"

    echo -e "\nDev server: $DEVHOST\nUsername: $DEVUSER\nPassword: $DEVPASS\n"
    echo "Temporary dev server alias setup."
    echo "To (re)install npm dependencies for the dev server, run 'devinstall'"
    echo "To start the development server in this terminal, run 'devserver'"

fi

